---
title: Simulating "The Dice Game" in R
author: Yeng Miller-Chang
date: '2022-02-09'
slug: dice-game-sim
categories: []
tags:
  - dnd
  - probability
---

*Views and opinions expressed are solely my own.*

A friend sent me the [following TikTok video](https://www.tiktok.com/@dimension20/video/7051989932579261742) where the speaker refers to "The Dice Game," consisting of the following steps:

* Roll a 4-sided die (d4). If you roll a 4, go on; otherwise, start over.
* Roll a 6-sided die (d6). If you roll a 6, go on; otherwise, start over from the 4-sided die.
* And repeat the process for a d8, d10, d12, and d20, starting over from the d4 if you do not attain the maximum value of the die you are rolling.

## How many rolls should we expect to roll to "win" the dice game?

We answer this question via a Monte Carlo simulation. This code could have not been written without the assistance of [David](https://math.stackexchange.com/users/602473/david) and an anonymous Discord user. 

```{r eval=FALSE}
library(future.apply)
plan(multisession)
start_time <- proc.time()
n_throws <- function(){
  throws <- 0
  repeat {
    repeat {
      repeat {
        repeat {
          repeat {
            repeat {
              dice4 <- sample.int(4, 1)
              throws <- throws + 1
              if (dice4 == 4) break
            }
            dice6 <- sample.int(6, 1)
            throws <- throws + 1
            if (dice6 == 6) break
          }
          dice8 <- sample.int(8, 1)
          throws <- throws + 1
          if (dice8 == 8) break
        }
        dice10 <- sample.int(10, 1)
        throws <- throws + 1
        if (dice10 == 10) break
      }
      dice12 <- sample.int(12, 1)
      throws <- throws + 1
      if (dice12 == 12) break
    }
    dice20 <- sample.int(20, 1)
    throws <- throws + 1
    if (dice20 == 20) break
  }
  return(throws)
}

data <- future_replicate(2000, n_throws())
> (proc.time() - start_time)/60
       user      system     elapsed 
0.006500000 0.001333333 7.040000000 
```

```{r echo=FALSE}
data <- c(915583, 582800, 284253, 140337, 19069, 476204, 3520, 414752, 
28633, 547284, 88915, 518355, 440339, 959430, 614259, 83543, 
1839487, 58877, 949594, 731321, 1106290, 565701, 98818, 96192, 
642909, 521776, 218298, 345849, 355287, 1107844, 1294989, 142203, 
195438, 209056, 67028, 39893, 451696, 634912, 423615, 94262, 
314451, 237923, 118297, 989757, 865836, 207189, 2296611, 21317, 
243189, 346886, 240589, 569915, 157122, 85635, 2638068, 1445053, 
143974, 655868, 75142, 408678, 403159, 998756, 191126, 656691, 
1133512, 812627, 637557, 1176000, 176422, 1517107, 34605, 2365337, 
803395, 554947, 842, 866102, 164549, 355760, 118758, 842434, 
204865, 283404, 174251, 418590, 145048, 1632453, 1387014, 85223, 
104614, 841177, 328614, 156108, 363363, 287406, 88441, 2023600, 
320180, 30721, 965963, 96256, 489961, 218445, 553772, 1821465, 
267372, 1032608, 256308, 102612, 1326483, 161775, 33302, 37412, 
56460, 2553126, 53209, 20976, 523396, 104198, 338306, 630226, 
435852, 1178353, 302870, 1045237, 434750, 53738, 939562, 460660, 
211067, 951218, 1636453, 267365, 5521, 3321176, 12238, 100435, 
1450992, 449987, 216569, 17419, 81356, 236625, 393408, 330262, 
810606, 204891, 7136, 636449, 812627, 193385, 621067, 233250, 
1492251, 604574, 77418, 215225, 179984, 136701, 1121343, 132169, 
605690, 669517, 411221, 1174563, 1954546, 48260, 92480, 420852, 
1315534, 214728, 744014, 1197844, 33183, 785440, 270484, 445535, 
22113, 550801, 763726, 476469, 622617, 303781, 976668, 374127, 
237371, 1087307, 133518, 7059, 2753211, 112480, 164913, 823350, 
1686891, 414292, 247065, 1672023, 1814036, 447892, 1260832, 891196, 
1492235, 555841, 690460, 824358, 1265196, 1148200, 1090388, 356931, 
2006639, 53750, 58097, 825223, 1152733, 204032, 334428, 301825, 
1879845, 1095547, 371829, 117740, 64980, 201367, 1922209, 1007638, 
624332, 47629, 308492, 88859, 1784575, 173106, 1983751, 497066, 
1111945, 854657, 72606, 321831, 1962855, 367625, 2843230, 671793, 
74565, 1041476, 288450, 239678, 669194, 1333574, 206073, 323421, 
92799, 642063, 633406, 1510293, 1029914, 841020, 272383, 1189309, 
225755, 1201759, 13930, 237632, 521580, 1055652, 162495, 218085, 
1431717, 149054, 191608, 471377, 7958, 2437110, 22591, 669357, 
961123, 3026869, 1862902, 93174, 2403721, 44, 28238, 316073, 
1661132, 26076, 1883110, 596431, 3796275, 511843, 572915, 285966, 
176188, 177937, 796667, 130146, 1525696, 70623, 1228389, 999940, 
2204448, 114349, 399700, 416250, 197626, 212103, 988349, 526517, 
520803, 2073329, 215153, 341067, 441227, 194325, 840734, 758347, 
284830, 1568952, 786257, 495703, 2122965, 730929, 964143, 287818, 
1004193, 730917, 60025, 892999, 220178, 257112, 1645400, 919429, 
304220, 145720, 984496, 47787, 3141556, 811392, 322158, 208849, 
51774, 838115, 91433, 318313, 495538, 366646, 736026, 154560, 
965549, 2078909, 107969, 1606656, 30078, 798745, 1613080, 90640, 
45313, 1583202, 706673, 42370, 1307507, 63490, 249161, 508937, 
352566, 421472, 368823, 791662, 642117, 186534, 831422, 82898, 
86014, 250756, 1059942, 595647, 267663, 1239134, 369121, 206791, 
68206, 1141346, 1291375, 541284, 778365, 810652, 1390118, 999200, 
455601, 96198, 106318, 202097, 718234, 37583, 679090, 1559628, 
78205, 110296, 489059, 902789, 569536, 412645, 246092, 70386, 
235649, 248335, 243334, 543256, 38036, 65982, 559772, 73880, 
160919, 121880, 220208, 199671, 1395854, 564443, 211284, 35004, 
97433, 1273018, 646080, 1154164, 227170, 812673, 221374, 369349, 
627629, 606366, 377912, 588325, 3185277, 322899, 365136, 516197, 
2344977, 774248, 798751, 1878515, 122047, 1583544, 266493, 1595899, 
1022817, 4594, 801112, 711535, 41864, 1355426, 673552, 1020533, 
123009, 543720, 475327, 2299903, 463867, 2682155, 1400727, 569249, 
842879, 1522548, 1215240, 1314087, 271232, 539637, 2614118, 16390, 
239369, 743314, 68572, 219525, 373585, 1719956, 80433, 225282, 
242929, 268012, 392802, 132251, 479001, 483037, 2321197, 1094007, 
792318, 696917, 1000401, 83098, 88427, 1382901, 568695, 420145, 
188300, 380283, 1488736, 463234, 367677, 1133018, 533282, 472380, 
864538, 573696, 998130, 225131, 1460852, 491659, 118229, 945681, 
24187, 300243, 273052, 1306448, 169758, 1388114, 360626, 2316254, 
718689, 728672, 221851, 53513, 787230, 348873, 2025849, 108552, 
807368, 768915, 574290, 408476, 248266, 627077, 329037, 596930, 
76403, 143298, 1889497, 910198, 638438, 303443, 126112, 457529, 
304887, 549205, 2032552, 473965, 634089, 173827, 1872992, 833508, 
378324, 816285, 732003, 190080, 20079, 184592, 587175, 61890, 
1063977, 1281896, 2630028, 202401, 70534, 1014208, 189050, 1756522, 
453311, 127817, 1043069, 832464, 432386, 330292, 67913, 286837, 
393725, 176748, 145779, 488264, 2976, 672366, 43968, 1219259, 
1610068, 346712, 29425, 75489, 59915, 282826, 28452, 813303, 
513785, 221224, 625135, 133468, 146311, 1100155, 351899, 712892, 
382482, 295251, 862490, 438982, 167252, 192018, 595178, 508971, 
512756, 557989, 734426, 353996, 51870, 1180932, 1166614, 1147113, 
79955, 816757, 385196, 636204, 120298, 623440, 2587008, 567950, 
29947, 62505, 446729, 89789, 683779, 771110, 17938, 167551, 385266, 
1361115, 109116, 164337, 86106, 1850505, 739508, 631052, 754497, 
171980, 12306, 350791, 596157, 1390940, 359310, 1030499, 137687, 
177532, 620832, 91453, 49086, 290595, 153121, 25822, 420493, 
926502, 1220009, 294361, 44522, 1033152, 391582, 244934, 608502, 
946110, 3360, 309458, 155419, 3744691, 1868422, 292057, 167021, 
438440, 207918, 728276, 1129949, 1208499, 1403210, 89863, 244784, 
1869486, 605096, 511956, 304090, 1062279, 2555244, 422147, 152656, 
250781, 369203, 106769, 335566, 498276, 222702, 1846372, 1455862, 
65386, 751880, 353432, 3177908, 87750, 134769, 563917, 48462, 
486528, 87558, 596329, 2434901, 373381, 9104, 1185132, 969572, 
934089, 1321891, 107833, 582809, 219780, 774157, 490004, 683004, 
2237771, 28398, 522309, 223668, 240010, 37043, 53726, 868458, 
32694, 757802, 657226, 122404, 1361836, 681010, 1919794, 1009217, 
3160390, 1348809, 1004403, 174464, 57813, 1764728, 223145, 399693, 
542295, 544727, 145365, 790763, 364922, 377024, 225376, 828665, 
759550, 903395, 316060, 1187530, 1441131, 255010, 649868, 329606, 
35884, 845459, 1075050, 1284791, 21820, 2972124, 695304, 111558, 
513592, 532509, 882213, 151918, 909105, 1114290, 223333, 2047913, 
273627, 272800, 312734, 260618, 606056, 141977, 1878156, 180743, 
346986, 256068, 57367, 1047778, 75634, 86223, 1081059, 134760, 
337843, 890598, 903561, 367856, 3448588, 35829, 1154781, 1592282, 
2269723, 986250, 1195841, 757256, 229073, 66742, 1208594, 509028, 
616082, 1006821, 941778, 139617, 1325912, 147609, 76175, 640003, 
1289947, 318673, 482277, 976316, 232048, 763223, 622556, 322391, 
511204, 432405, 463919, 265747, 1021826, 414897, 1209997, 281563, 
1757185, 264265, 1122793, 400791, 1095894, 1355485, 712922, 735079, 
102981, 242956, 213498, 115060, 2229037, 838374, 418860, 1187662, 
1230614, 585676, 1059917, 624635, 266756, 257523, 728054, 992373, 
818312, 268948, 2494204, 324001, 403979, 851417, 185104, 944512, 
789437, 903180, 445681, 722732, 1205473, 932150, 274294, 46421, 
535752, 1300585, 845440, 1173933, 186658, 186907, 1145581, 241111, 
168166, 867473, 651568, 451380, 633312, 925218, 540508, 132403, 
197140, 202160, 824921, 539900, 171722, 853036, 1463195, 423608, 
1340260, 333226, 184098, 291099, 80473, 438321, 234477, 77009, 
976706, 1777601, 1092123, 666964, 441290, 1164614, 1225065, 123267, 
795440, 227489, 702144, 1466283, 4103536, 10838, 348108, 1080538, 
1419841, 578120, 1478657, 1939894, 2532, 1774120, 55929, 1617815, 
554757, 517344, 16705, 770981, 208027, 99962, 974391, 522602, 
161150, 171225, 236754, 781746, 3441107, 256171, 553858, 633687, 
519187, 1103512, 90845, 424242, 22993, 397079, 224634, 103108, 
1113030, 328443, 1861839, 173963, 1511090, 1351666, 13871, 716847, 
581443, 81684, 516017, 182630, 1343907, 841508, 668494, 2081233, 
159101, 76691, 592793, 1152248, 108860, 789626, 153728, 199809, 
451590, 567037, 1011822, 759708, 734340, 569259, 3225895, 378046, 
382341, 431812, 872908, 888178, 1315297, 591863, 1637617, 693059, 
1231002, 60795, 623328, 1002979, 177025, 817172, 431227, 2418847, 
1306719, 1296149, 331842, 1138538, 135390, 40223, 283253, 105398, 
41918, 801567, 401051, 346374, 808786, 535703, 1056603, 988381, 
1662333, 622059, 164343, 69796, 1616542, 77870, 138036, 147982, 
1433685, 484849, 101369, 354009, 275250, 208723, 66712, 377173, 
1154745, 1291806, 2340842, 1076837, 439914, 885454, 210731, 663653, 
378466, 2055909, 1100089, 13050, 52946, 56624, 290448, 1253537, 
407645, 513095, 198545, 314743, 773832, 433836, 23312, 182143, 
201733, 2869567, 2005440, 392778, 217256, 296917, 507009, 624264, 
691487, 55252, 524559, 69401, 1518259, 838549, 1270178, 574252, 
34914, 259852, 107780, 1929558, 75442, 788685, 403981, 132603, 
1395997, 514436, 41597, 980895, 769023, 764555, 2450365, 251690, 
470057, 566621, 340369, 320566, 1077044, 216897, 363866, 748363, 
308971, 660481, 66700, 1436827, 12089, 209719, 282457, 793630, 
395370, 126303, 238541, 915630, 178311, 125617, 26473, 452944, 
128148, 1666380, 273506, 572254, 572687, 882677, 1630725, 69911, 
158132, 584234, 245668, 90695, 253852, 843499, 933834, 883129, 
716813, 1096250, 108693, 505739, 556568, 578720, 5446, 1572424, 
110036, 417763, 124965, 1677484, 663793, 599566, 430595, 2752578, 
1946390, 610644, 1516358, 653501, 253061, 1497510, 97558, 426262, 
833079, 315690, 729709, 2691594, 338293, 1042412, 152595, 876318, 
749082, 1659915, 587048, 895817, 1085004, 296136, 781099, 362248, 
65137, 150859, 189178, 193545, 1126911, 100135, 314721, 896697, 
126998, 1084026, 3273072, 143153, 203632, 174374, 628945, 318139, 
17490, 97272, 38599, 546332, 267071, 24352, 238721, 30090, 54797, 
11007, 431462, 472357, 85437, 2347110, 3804020, 2255808, 291422, 
156194, 622074, 1076442, 629724, 123364, 1501417, 43459, 523751, 
384544, 248813, 1330719, 164079, 691867, 72124, 301209, 568214, 
121035, 173435, 238247, 574755, 772495, 343438, 480830, 3402195, 
691069, 347257, 609098, 570369, 77069, 401347, 1440638, 357822, 
28720, 333027, 225425, 1510952, 534060, 407293, 1163718, 1694854, 
573270, 625209, 379724, 48901, 990919, 1099944, 2371968, 340788, 
95581, 36812, 274125, 262017, 270951, 172996, 322012, 90625, 
312448, 294739, 543422, 855331, 154747, 752309, 41520, 1422007, 
977370, 1068971, 1191708, 85338, 658087, 948719, 78252, 38455, 
237932, 202729, 1196536, 401062, 832482, 614667, 733907, 41989, 
528685, 605264, 150258, 370079, 285745, 2544907, 789847, 392845, 
221908, 1091561, 118005, 449213, 941946, 482665, 889663, 320660, 
674365, 191460, 623212, 1174015, 909653, 533950, 268182, 227338, 
25777, 242415, 1400803, 424244, 78319, 1093435, 872715, 358689, 
19201, 224555, 492032, 865495, 331997, 970780, 23290, 537969, 
994172, 636390, 1028684, 141135, 118224, 1766590, 434559, 94771, 
854797, 424434, 304520, 1888478, 2629549, 291090, 1418151, 661836, 
4645, 695658, 137539, 785201, 1882153, 149103, 1783859, 226586, 
103255, 728853, 256716, 256101, 385425, 6021, 728567, 214126, 
2067358, 121090, 1498267, 212130, 145090, 332833, 159806, 587897, 
184215, 631369, 1942913, 36618, 1165134, 651216, 2057028, 25772, 
629278, 545983, 1198589, 624074, 212160, 284442, 690351, 26496, 
14905, 262940, 629432, 1152841, 690200, 213671, 1183120, 87757, 
428043, 11728, 2855438, 558111, 398530, 686299, 524310, 604994, 
447371, 1080294, 240881, 963089, 946624, 284393, 254581, 253920, 
91622, 466132, 1031682, 505682, 151926, 423631, 261815, 306370, 
60326, 707801, 241245, 1332323, 125440, 72836, 5887, 977137, 
938230, 164389, 2194306, 449042, 718492, 507710, 41308, 589574, 
144733, 69254, 397417, 730277, 369857, 1424150, 145233, 1534743, 
248463, 63865, 773715, 134149, 135528, 304930, 1757457, 111780, 
752315, 375632, 573655, 372675, 9367, 1550260, 982583, 723719, 
123848, 154373, 133690, 188397, 78636, 113649, 15914, 95266, 
340222, 993400, 527808, 299792, 1356774, 439329, 1273383, 1257807, 
89501, 756977, 91787, 985278, 1467486, 379855, 7223, 130568, 
912745, 15935, 2308271, 826646, 120364, 654939, 117271, 1353395, 
511208, 56083, 284099, 118163, 300597, 648484, 696528, 240089, 
172144, 305712, 1628694, 752728, 450192, 1021727, 512861, 1482360, 
128691, 353029, 146100, 1372641, 758215, 67792, 427842, 249759, 
215735, 595389, 578667, 474679, 286582, 260847, 737148, 1276031, 
381836, 2733858, 902517, 1422884, 611206, 17921, 69256, 153061, 
232744, 556274, 2610325, 487107, 555427, 457564, 679847, 153397, 
631801, 520007, 892822, 2313107, 1024380, 144046, 151878, 946594, 
440158, 442482, 399885, 564822, 1809942, 114590, 135662, 743025, 
236901, 2244206, 575835, 538946, 1312358, 192163, 107708, 875, 
197533, 269254, 660765, 122547, 248536, 214369, 2542212, 24598, 
419421, 210949, 1799246, 389289, 403177, 205592, 200605, 19285, 
20242, 30536, 43268, 564995, 1011995, 1299916, 1193813, 48211, 
43037, 250819, 1259819, 607517, 1664756, 44575, 995936, 181914, 
1234149, 994090, 149325, 649050, 209730, 499405, 901497, 1002412, 
271477, 787744, 47503, 1115009, 329565, 208476, 1375202, 307116, 
85662, 772971, 183135, 773600, 116013, 2718702, 2233584, 3261223, 
123209, 309576, 61936, 618133, 495858, 1313139, 878964, 140027, 
2094870, 785749, 899796, 298368, 10022, 1427841, 501843, 1096379, 
1956366, 1045958, 572840, 2765756, 1236, 408867, 44053, 602754, 
545484, 79141, 240499, 2138039, 156758, 164478, 271494, 1611064, 
819088, 878822, 412093, 225311, 1021318, 1398626, 68526, 941975, 
242402, 100916, 180822, 80743, 134096, 211684, 552560, 460289, 
499924, 1197218, 135868, 174862, 124453, 1634894, 105929, 1511582, 
56300, 207265, 120868, 1064087, 37342, 508970, 1217445, 686325, 
150565, 54026, 532936, 1188847, 511173, 557833, 460999, 432339, 
441408, 398193, 481489, 442873, 951009, 1330266, 128211, 390068, 
151839, 532186, 144707, 256485, 180261, 824870, 1002203, 166783, 
109301, 369946, 1598352, 281328, 317877, 248454, 283172, 167779, 
656849, 48197, 122740, 44457, 973833, 2012025, 1253945, 239174, 
162780, 105501, 1278045, 84851, 769299, 1443671, 26393, 35183, 
290026, 83089, 286998, 339506, 507628, 2086196, 431151, 635919, 
1239035, 150831, 1607008, 131507, 93163, 491220, 101167, 562024, 
146878, 195963, 409692, 102802, 338663, 393125, 279126, 616773, 
471110, 23193, 2924065, 328381, 267484, 1503607, 1161002, 101210, 
140314, 116106, 847068, 1554254, 798205, 617883, 501037, 328024, 
633771, 584637, 181078, 947256, 280550, 216690, 152926, 128435, 
1301275, 824975, 381001, 64134, 1654048, 74233, 135478, 479261, 
276016, 150741, 740647, 373486, 2253774, 321750, 68029, 26118, 
64559, 1106365, 973942, 124291, 1212635, 28781, 646357, 567252, 
248020, 102877, 4145846, 812607, 825478, 7581, 1969639, 1716248, 
378093, 355439, 607353, 482495, 652290, 28386, 1308405, 5158, 
25584, 1019285, 2280299, 142441, 456940, 1675193, 842586, 261727, 
744068, 252752, 66318, 437396, 440835, 1375936, 390566, 244147, 
2844005, 317705, 62111, 513363, 3532446, 1003134, 774242, 234281, 
102122, 139509, 295033, 198181, 513607, 313854, 237757, 178138, 
1189993, 471091, 265493, 52494, 1583002, 755355, 2197515, 568083, 
678761, 279680, 53178, 400451, 873967, 161557, 910554, 753797, 
809485, 181435, 693131, 308270, 81169, 124479, 592269, 830600, 
350355, 2137730, 620683, 2069797, 343849, 302990, 1116886, 619627, 
411274, 840448, 351371, 430382, 879070, 1889742, 16234, 209933, 
38758, 332822, 647220, 160611, 1840454, 1420138, 2995165, 191785, 
330804, 1403734, 363582, 1728134, 90685, 1110336, 577998, 90671, 
14417, 410170, 116701, 273146, 2004613, 267050, 2042238, 57997, 
1606131, 80143, 1156549, 417044, 1528934, 36825, 8144, 765747, 
144920, 378553, 783843, 312352, 535433, 202733, 783813, 557219, 
56307, 90616, 1563165, 523500, 53095, 861274, 243523, 761294, 
263989, 765820, 583862, 820467, 424109, 1322058, 994720, 1200248, 
91417, 485039, 15986, 652474, 199536, 749556, 569926, 564191, 
42066, 366559, 257999, 1833065, 380472, 67345, 1331225, 128375, 
313485, 1075326, 213329, 896793, 4244, 192205, 150673, 571488, 
1085544, 55145, 640335, 339848, 244401, 965637, 153447, 471732, 
282658, 670437, 2294702, 86548, 522206, 1696, 1081713, 144954, 
209328, 73770, 235179, 1303199, 55493, 1668642, 39502, 100772, 
720053, 141970, 584260, 626763, 107681, 1080544, 1413189, 198211, 
193294, 294864, 2424089, 77258, 1687172, 403562, 2086460, 216091, 
353555, 245430, 91913, 653749, 994060, 1072323)
```

Below we show a histogram of these data.

```{r message=FALSE, warning=FALSE, fig.width=9}
library(ggplot2)
ggplot(data.frame(x = data), aes(x = x)) + 
  geom_histogram(breaks = seq(0, 5e6, 500000), 
                 fill = "blue", 
                 alpha = 0.25) + 
  stat_bin(aes(y = ..count.., label = ..count..), 
           geom="text", 
           breaks = seq(0, 5e6, 500000), 
           position = position_stack(vjust = 1.05)) +
  scale_x_continuous(labels = function(x) { x/1e6 }) + 
  scale_y_continuous(breaks = seq(0, 1000, 200)) + 
  theme_bw() + 
  ylab("Count") + 
  xlab("Number of Dice Rolls (in millions)")
```
Noticeably, these data are right-skewed (skewness estimate of `r e1071::skewness(data, type = 1)`). Our standard five-number summary in summarizing these data is:

```{r}
summary(data)
```
Thus 25% of the time (roughly 500 of the 2000 trials), we have up to 183,000 or so rolls; and about 50% of the time, we have up to around 445,000 rolls. This is an astonishing amount of variability; one would hope that these estimates would stabilize eventually. On average, we have an estimate of around 642,000 rolls; however, one must keep the variability in these data in mind when attempting to interpret this average.

Obviously, if I have more time available, I will increase the number of trials for this simulation.

## Some Comments on Theory

One can observe this is a Markov chain, where the states can all be given by rolling the given dice, and the only possible transitions are d4 to d4, d4 to any one of the other die, and d20 to an ending state of finishing the game. I am not as familiar with the theory of stochastic processes as I'd like, but I would imagine additional insight can be provided there.